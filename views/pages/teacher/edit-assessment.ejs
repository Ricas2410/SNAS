<%- include('../../partials/header', { title: 'Edit Assessment' }) %>
<%- include('../../partials/sidebar', { user: user, role: user.role }) %>


<style>
    .container {
        margin-left: 250px; /* Same width as the sidebar */
        padding: 20px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .container {
            margin-left: 0; /* Remove margin for small screens */
        }
    }
    
</style>

<div class="dashboard-container container">
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h1>Edit Assessment for <%= assessment.Student.name %></h1>
                </div>
                <div class="card-body">
                    <!-- Headteacher's Comment -->
                    <% if (assessment.headteacherComment) { %>
                        <div class="alert alert-info">
                            <strong>Headteacher's Comment:</strong> <%= assessment.headteacherComment %>
                        </div>
                    <% } %>

                    <!-- Assessment Form -->
                    <form action="/teacher/assessment/update/<%= assessment.id %>" method="POST">
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" class="form-control" id="date" name="date" value="<%= assessment.date.toISOString().split('T')[0] %>" required>
                        </div>

                        <div class="form-group">
                            <label for="weekNumber">Week Number</label>
                            <input type="number" class="form-control" id="weekNumber" name="weekNumber" value="<%= assessment.weekNumber %>" required>
                        </div>

                        <!-- Subjects Assessment -->
                        <h4 class="mt-4">Subjects</h4>
                        <table class="table table-bordered mt-3">
                            <thead class="thead-light">
                                <tr>
                                    <th>Subject</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% subjects.forEach(function(subject) { %>
                                    <tr>
                                        <td><%= subject.name %></td>
                                        <td>
                                            <% const subjectAssessment = assessment.SubjectAssessments.find(sa => sa.Subject && sa.Subject.id === subject.id) %>
                                            <textarea class="form-control" name="subjects[<%= subject.id %>]" rows="3"><%= subjectAssessment ? subjectAssessment.comment : '' %></textarea>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>

                        <!-- Assessment Summary -->
                        <div class="form-group">
                            <label for="summary">Assessment Summary</label>
                            <textarea class="form-control" id="summary" name="summary" rows="5"><%= assessment.summary %></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Update Assessment</button>
                        <a href="/teacher/dashboard" class="btn btn-secondary mt-3">Back to Dashboard</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../../partials/footer') %>
</div>
