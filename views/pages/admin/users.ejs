<%- include('../../partials/header', {title: 'Manage Users'}) %>
<%- include('../../partials/sidebar', { user: user, role: user.role }) %>

<style>
    .container {
        margin-left: 250px; /* Same width as the sidebar */
        padding: 20px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .container {
            margin-left: 0; /* Remove margin for small screens */
        }
    }
</style>

<div class="dashboard-container container">
  <h1 class="mb-4">Manage Users</h1>

  <a href="/admin/user/add" class="btn btn-primary mb-3">Add New User</a>

  <ul class="nav nav-tabs mb-3" id="userTabs" role="tablist">
    <li class="nav-item">
      <a
        class="nav-link active"
        id="admins-tab"
        data-toggle="tab"
        href="#admins"
        role="tab"
        aria-controls="admins"
        aria-selected="true"
        >Admins</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="teachers-tab"
        data-toggle="tab"
        href="#teachers"
        role="tab"
        aria-controls="teachers"
        aria-selected="false"
        >Teachers</a
      >
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="headteachers-tab"
        data-toggle="tab"
        href="#headteachers"
        role="tab"
        aria-controls="headteachers"
        aria-selected="false"
        >Headteachers</a
      >
    </li>
  </ul>

  <div class="tab-content" id="userTabsContent">
    <div
      class="tab-pane fade show active"
      id="admins"
      role="tabpanel"
      aria-labelledby="admins-tab"
    >
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Full Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.filter(user => user.role === 'admin').forEach(function(user) { %>
          <tr>
            <td><%= user.id %></td>
            <td><%= user.username %></td>
            <td><%= user.fullName %></td>
            <td>
              <a
                href="/admin/user/edit/<%= user.id %>"
                class="btn btn-sm btn-warning"
                >Edit</a
              >
              <form
                action="/admin/user/delete/<%= user.id %>"
                method="POST"
                class="d-inline"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-danger"
                  onclick="return confirm('Are you sure you want to archive this user?')"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <div
      class="tab-pane fade"
      id="teachers"
      role="tabpanel"
      aria-labelledby="teachers-tab"
    >
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Full Name</th>
            <th>Assigned Classes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.filter(user => user.role === 'teacher').forEach(function(user) { %>
          <tr>
            <td><%= user.id %></td>
            <td><%= user.username %></td>
            <td><%= user.fullName %></td>
            <td>
              <% if (user.Classes && user.Classes.length > 0) { %> <%= user.Classes.map(c => c.name).join(', ') %> <% } else { %> Not Assigned <% } %>
            </td>
            <td>
              <a
                href="/admin/user/edit/<%= user.id %>"
                class="btn btn-sm btn-warning"
                >Edit</a
              >
              <form
                action="/admin/user/delete/<%= user.id %>"
                method="POST"
                class="d-inline"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-danger"
                  onclick="return confirm('Are you sure you want to archive this user?')"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <div
      class="tab-pane fade"
      id="headteachers"
      role="tabpanel"
      aria-labelledby="headteachers-tab"
    >
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Full Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.filter(user => user.role === 'headteacher').forEach(function(user) { %>
          <tr>
            <td><%= user.id %></td>
            <td><%= user.username %></td>
            <td><%= user.fullName %></td>
            <td>
              <a
                href="/admin/user/edit/<%= user.id %>"
                class="btn btn-sm btn-warning"
                >Edit</a
              >
              <form
                action="/admin/user/delete/<%= user.id %>"
                method="POST"
                class="d-inline"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-danger"
                  onclick="return confirm('Are you sure you want to archive this user?')"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>

  <a href="/admin/dashboard" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>

<%- include('../../partials/footer') %>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  $(document).ready(function () {
    $("#userTabs a").click(function (e) {
      e.preventDefault();
      $(this).tab("show");
    });
  });
</script>
