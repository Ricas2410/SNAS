<%- include('../../partials/header', {title: 'Past Assessments'}) %>
<%- include('../../partials/sidebar', { user: user, role: user.role }) %>


<style>
    .container {
        margin-left: 250px; /* Same width as the sidebar */
        padding: 20px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .container {
            margin-left: 0; /* Remove margin for small screens */
        }
    }
    
</style>

<div class="dashboard-container container">
    <h1 class="text-center mb-4">Past Assessments for <%= student.name %></h1>

    <div class="mb-3">
        <label for="weekFilter">Filter by Week:</label>
        <select id="weekFilter" class="form-control">
            <option value="">All Weeks</option>
            <% for (let i = 1; i <= 52; i++) { %>
                <option value="<%= i %>">Week <%= i %></option>
            <% } %>
        </select>
    </div>

    <div id="assessmentsList">
        <% if (assessments.length === 0) { %>
            <p class="text-center">No past assessments found for this student.</p>
        <% } else { %>
            <% assessments.forEach(function(assessment) { %>
                <div class="card mb-3 assessment-card" data-week="<%= assessment.weekNumber %>">
                    <div class="card-header">
                        Week <%= assessment.weekNumber %> - <%= assessment.date.toISOString().split('T')[0] %>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Subject Assessments</h5>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th style="width: 40%">Subject</th>
                                    <th style="width: 60%">Teacher's Comments</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% assessment.SubjectAssessments.forEach(function(subjectAssessment) { %>
                                    <tr>
                                        <td><%= subjectAssessment.Subject ? subjectAssessment.Subject.name : 'Unknown Subject' %></td>
                                        <td><%= subjectAssessment.comment %></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5 class="card-title">Teacher's Summary</h5>
                                <p class="card-text"><%= assessment.summary %></p>
                            </div>
                            <div class="col-md-6">
                                <h5 class="card-title">Headteacher's Comment</h5>
                                <p class="card-text"><%= assessment.headteacherComment || 'No comment' %></p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h5 class="card-title">Status</h5>
                            <p class="card-text"><strong>
                                <% if (assessment.status === 'pending') { %>
                                    Pending Review
                                <% } else if (assessment.status === 'approved') { %>
                                    Approved
                                <% } else if (assessment.status === 'changes-requested') { %>
                                    Changes Requested
                                <% } %>
                            </strong></p>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } %>
    </div>

    <div class="text-center">
        <a href="/teacher/student/<%= student.id %>" class="btn btn-secondary mt-3">Back to Student</a>
    </div>
</div>

<script>
    document.getElementById('weekFilter').addEventListener('change', function() {
        const selectedWeek = this.value;
        const assessmentCards = document.querySelectorAll('.assessment-card');
        
        assessmentCards.forEach(card => {
            if (selectedWeek === '' || card.dataset.week === selectedWeek) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>

<%- include('../../partials/footer') %>
