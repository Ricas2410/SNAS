<%- include('../partials/header', {title: 'Notification History'}) %>
<%- include('../../partials/header', {title: 'Pending Assessments'}) %>
<%- include('../../partials/sidebar', { user: user, role: user.role }) %>


<style>
    .container {
        margin-left: 250px; /* Same width as the sidebar */
        padding: 20px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .container {
            margin-left: 0; /* Remove margin for small screens */
        }
    }
    
</style>

<div class="dashboard-container container">
<h1>Notification History</h1>

<% if (notifications.length === 0) { %>
    <p>No notifications found.</p>
<% } else { %>
    <ul class="list-group">
        <% notifications.forEach(function(notification) { %>
            <li class="list-group-item <%= notification.read ? '' : 'font-weight-bold' %>">
                <%= notification.message %>
                <small class="text-muted">(<%= notification.createdAt.toLocaleString() %>)</small>
                <button class="btn btn-sm btn-danger float-right delete-notification" data-id="<%= notification.id %>">Delete</button>
            </li>
        <% }); %>
    </ul>
<% } %>

<script>
$(document).ready(function() {
    $('.delete-notification').on('click', function() {
        const notificationId = $(this).data('id');
        if (confirm('Are you sure you want to delete this notification?')) {
            fetch(`/notifications/delete/${notificationId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        $(this).closest('li').remove();
                    } else {
                        alert('Failed to delete notification');
                    }
                })
                .catch(error => {
                    console.error('Error deleting notification:', error);
                    alert('An error occurred while deleting the notification');
                });
        }
    });
});
</script>

<%- include('../partials/footer') %>
</div>